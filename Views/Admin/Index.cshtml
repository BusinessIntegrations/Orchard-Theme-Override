@model Piedone.ThemeOverride.ViewModels.EditorViewModel

@{
    Layout.Title = T("Theme Override Settings");

    Style.Include("theme-override-admin.css");
    Script.Require("AceEditor.NoConflict").AtFoot();
}

<h1>@T("Theme Override Settings")</h1>

<div class="hint">
    @T("Here you can override the current theme's styling, scripts and placement.")
</div>

@using (Html.BeginFormAntiForgeryPost())
{
    @Html.HiddenFor(m => m.CustomStylesContent)
    @Html.HiddenFor(m => m.CustomHeadScriptContent)
    @Html.HiddenFor(m => m.CustomFootScriptContent)

    <fieldset id="theme-override-stlyes">
        <legend>@T("Styles")</legend>
        <ol>
            <li>
                @Html.LabelFor(m => m.StylesheetUrl, T("Stylesheet URL"))
                @Html.TextBoxFor(m => m.StylesheetUrl, new { @class = "text large" })
                <span class="hint">@T("You can include an existing stylesheet here. This is meant for external stylesheets but will work for internal ones too. When including external stylesheets it's advised to use the protocol-relative format (i.e. not http:// but //).")</span>
            </li>
            <li>
                @Html.LabelFor(m => m.CustomStylesContent, T("Custom styles"))
                <div id="theme-override-custom-styles-editor">@Model.CustomStylesContent</div>
                <span class="hint">@T("This stylesheet will be included last, so you can override any styling.")</span>
            </li>
        </ol>
    </fieldset>
    <fieldset id="theme-override-scripts">
        <legend>@T("Scripts")</legend>
        <ol>
            <li>
                @Html.LabelFor(m => m.HeadScriptUrl, T("Head script URL"))
                @Html.TextBoxFor(m => m.HeadScriptUrl, new { @class = "text large" })
                <span class="hint">@T("You can include an existing script here for the head. This is meant for external scripts but will work for internal ones too. When including external scripts it's advised to use the protocol-relative format (i.e. not http:// but //).")</span>
            </li>
            <li>
                @Html.LabelFor(m => m.CustomHeadScriptContent, T("Custom head script"))
                <div id="theme-override-custom-head-script-editor">@Model.CustomHeadScriptContent</div>
                <span class="hint">@T("This head script will be included last, so you can override any head script behaviour.")</span>
            </li>
            <li>
                @Html.LabelFor(m => m.FootScriptUrl, T("Foot script URL"))
                @Html.TextBoxFor(m => m.FootScriptUrl, new { @class = "text large" })
                <span class="hint">@T("You can include an existing script here for the foot. This is meant for external scripts but will work for internal ones too. When including external scripts it's advised to use the protocol-relative format (i.e. not http:// but //).")</span>
            </li>
            <li>
                @Html.LabelFor(m => m.CustomFootScriptContent, T("Custom foot script"))
                <div id="theme-override-custom-foot-script-editor">@Model.CustomFootScriptContent</div>
                <span class="hint">@T("This foot script will be included last, so you can override any head script behaviour.")</span>
            </li>
        </ol>
    </fieldset>
    <fieldset>
        <button class="primaryAction" type="submit" name="submit.Save" value="submit.Save">@T("Save")</button>
    </fieldset>
}

@using (Script.Foot())
{
    <script type="text/javascript">
        (function ($) {
            $(function () {
                $("#theme-override-stlyes legend, #theme-override-scripts legend")
                    .expandoControl(function (controller) { return controller.next("ol"); }, { collapse: true, remember: true });

                var styleEditor = ace.edit("theme-override-custom-styles-editor");
                styleEditor.getSession().setMode("ace/mode/css");
                var headScriptEditor = ace.edit("theme-override-custom-head-script-editor");
                headScriptEditor.getSession().setMode("ace/mode/javascript");
                var footScriptEditor = ace.edit("theme-override-custom-foot-script-editor");
                footScriptEditor.getSession().setMode("ace/mode/javascript");

                var $styleOverride = $("#@Html.FieldIdFor(m => m.CustomStylesContent)");
                $($styleOverride[0].form).submit(function () {
                    $styleOverride.val(styleEditor.getValue());
                    $("#@Html.FieldIdFor(m => m.CustomHeadScriptContent)").val(headScriptEditor.getValue());
                    $("#@Html.FieldIdFor(m => m.CustomFootScriptContent)").val(footScriptEditor.getValue());
                });
            });
        })(jQuery);
    </script>
}
